\documentclass{letter}
\usepackage{amssymb,amsthm,amsmath}
\usepackage{fullpage}

\newtheorem{Lemma}{Lemma}

\begin{document}
A family $H$ of $\epsilon$-almost-universal hash functions from the domain $D$ is a finite set such that

$$
\forall x \in D, y \in D, x \neq y \Rightarrow |\{h \in H : h(x) = h(y)\}| \leq \epsilon |H|
$$

For $h : (D \times D) \to D$, define $h_k : D^k \to D^{k/2}$ by 

$$
h_k((d_1,d_2,\dots,d_k)) \triangleq (h(d_1,d_2),h(d_3,d_4),\dots,h(d_{k-1},d_k)).
$$

Obviously, $k$ must be even.

Additionally, define $h^n_k : D^{k} \to D^{k/2^n}$ by

\begin{align*}
h^1_k &\triangleq h_k\\
h^n_k &\triangleq h^{n-1}_{k/2} \circ h_k
\end{align*}

Obviously, $k$ must be divisible by $2^n$.

When $H$ is an $\epsilon$-almost-universal hash family with domain $U\times U$ and codomain $U$,
define 

$$
H^n_k \triangleq \{h^n_k : h \in H\}.
$$

\begin{Lemma}
$H^n_k$ is an $n\epsilon$-almost universal hash family.
\end{Lemma}
\begin{proof}
By induction on $n$.

If $n$ is 1, then $H^n_k = H^1_k = \{h_k : h \in H\}$.
For any $x,y \in D^k$, if $x \neq y$, $\exists i \in [1,k]$ such that $x_i \neq y_i$.
Assume wlog that $i$ is even.
Then 

$$
|\{h \in H : h((x_{i-1},x_i)) = h((y_{i-1},y_i))\}| \leq \epsilon |H|
$$

As a result, 

\begin{align*}
\frac{|\{h_k \in H^1_k : h_k(x) = h_k(y)\}|}{|H^1_k|} &=
\frac{|\{h \in H : \land_{j=1}^{k/2} (h((x_{2j-1},x_{2j})) = h((y_{2j-1},y_{2j})))\}|}{|H|}\\
&\leq \frac{|\{h \in H : h((x_{i-1},x_i)) = h((y_{i-1},y_i))\}|}{|H|}\\
&\leq \epsilon
\end{align*}

This covers the base case.

For the inductive case, remember that

$$
h^n_k = h^{n-1}_{k/2} \circ h_k.
$$

By the analysis above, $\{h_k : h \in H\}$ is $\epsilon$-almost universal for all $k$: for all $x,y \in D^k$, $x \neq y$, $|\{h \in H : h_k(x) = h_k(y)\}| \leq \epsilon |H|$.

By the induction hypothesis, for all $p,q \in D^{k/2}$, $p \neq q$, $|\{h \in H : h^{n-1}_{k/2}(p) = h^{n-1}_{k/2}(q)\}| \leq (n-1)\epsilon |H|$. 
This is true for all unequal $p$ and $q$, so it is true as well for $p = h_k(x)$ and $q = h_k(y)$, if they are unequal.

For $x,y \in D^k$, $x \neq y$:

\begin{align*}
&|\{h \in H : h^n_k(x) = h^n_k(y)\}| = |\{h \in H : h^{n-1}_{k/2}(h_k(x)) = h^{n-1}_{k/2}(h_k(y))\}| \\
&= |\{h \in H : h_k(x) = h_k(y) \lor (h_k(x) \neq h_k(y) \land h^{n-1}_{k/2}(h_k(x)) = h^{n-1}_{k/2}(h_k(y)))\}| \\
&= |\{h \in H : h_k(x) = h_k(y)\} \dot{\cup} \{h \in H : h_k(x) \neq h_k(y) \land h^{n-1}_{k/2}(h_k(x)) = h^{n-1}_{k/2}(h_k(y))\}| \\
&= |\{h \in H : h_k(x) = h_k(y)\}| + |\{h \in H : h_k(x) \neq h_k(y) \land h^{n-1}_{k/2}(h_k(x)) = h^{n-1}_{k/2}(h_k(y))\}| \\
&\leq \epsilon |H| + |\{h \in H : h_k(x) \neq h_k(y) \land h^{n-1}_{k/2}(h_k(x)) = h^{n-1}_{k/2}(h_k(y))\}| \\
&\leq \epsilon |H| + |\{h \in H : h^{n-1}_{k/2}(p) = h^{n-1}_{k/2}(q)\}| \\
&\leq \epsilon |H| + (n-1) \epsilon |H|\\
&\leq n \epsilon |H|
\end{align*}

\end{proof}

Using Theorem 5.6 of Stinson's ``Universal hashing and authentication codes'', we can compose this $\epsilon$-almost universal hash family $H^n_k$ with a $\delta$-almost strongly universal hash family $G$ using $g \circ h$ and get a $(\epsilon+\delta)$-almost stringly universal hash function.

%Let $G$ be an $\delta$-almost strongly universal hash function, so that, for all $x,y$ and all $i,j$,

%$$
%|\{g \in G : g(x) = i \land g(y) = j\}| |G| \leq \delta |\{g \in G : g(x) = i\}| |\{g \in G : g(y) = j\}| 
%$$

%For any $\epsilon$-almost universal $H$, 

\end{document}
